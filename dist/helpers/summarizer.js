'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.splitContentToParagraphs = splitContentToParagraphs;
exports.formatSentence = formatSentence;
exports.getBestSentence = getBestSentence;
exports.getSortedSentences = getSortedSentences;
exports.getSentencesRanks = getSentencesRanks;

var _sbd = require('sbd');

var _sbd2 = _interopRequireDefault(_sbd);

var _lodash = require('lodash');

var _lodash2 = _interopRequireDefault(_lodash);

var _intersectSafe = require('./intersectSafe');

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }

function splitContentToSentences(content) {
  if (content.indexOf('.') === -1) return [];
  return _sbd2.default.sentences(content, { newline_boundaries: true }) || [];
}

function splitContentToParagraphs(content) {
  return content.split('\n\n');
}

function sentencesIntersection(sent1, sent2) {
  var s1 = sent1.split(' ');
  var s2 = sent2.split(' ');

  if (s1.length + s2.length === 0) return 0;

  var intersect = (0, _intersectSafe.intersectSafe)(s1, s2);
  var spliceHere = (s1.length + s2.length) / 2;
  return intersect.splice(0, spliceHere).length;
}

function formatSentence(sentence) {
  if (sentence && sentence.replace) {
    // To support unicode characters.
    // http://www.unicode.org/reports/tr29/WordBreakTest.html
    var re = /[^A-Za-z\u00AA\u00B5\u00BA\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u0236\u0250-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EE\u0345\u037A\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03CE\u03D0-\u03F5\u03F7-\u03FB\u0400-\u0481\u048A-\u04CE\u04D0-\u04F5\u04F8-\u04F9\u0500-\u050F\u0531-\u0556\u0559\u0561-\u0587\u05B0-\u05B9\u05BB-\u05BD\u05BF\u05C1-\u05C2\u05C4\u05D0-\u05EA\u05F0-\u05F3\u0610-\u0615\u0621-\u063A\u0640-\u0657\u066E-\u06D3\u06D5-\u06DC\u06E1-\u06E8\u06ED-\u06EF\u06FA-\u06FC\u06FF\u0710-\u073F\u074D-\u074F\u0780-\u07B1\u0901-\u0939\u093D-\u094C\u0950\u0958-\u0963\u0981-\u0983\u0985-\u098C\u098F-\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD-\u09C4\u09C7-\u09C8\u09CB-\u09CC\u09D7\u09DC-\u09DD\u09DF-\u09E3\u09F0-\u09F1\u0A01-\u0A03\u0A05-\u0A0A\u0A0F-\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32-\u0A33\u0A35-\u0A36\u0A38-\u0A39\u0A3E-\u0A42\u0A47-\u0A48\u0A4B-\u0A4C\u0A59-\u0A5C\u0A5E\u0A70-\u0A74\u0A81-\u0A83\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2-\u0AB3\u0AB5-\u0AB9\u0ABD-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACC\u0AD0\u0AE0-\u0AE3\u0B01-\u0B03\u0B05-\u0B0C\u0B0F-\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32-\u0B33\u0B35-\u0B39\u0B3D-\u0B43\u0B47-\u0B48\u0B4B-\u0B4C\u0B56-\u0B57\u0B5C-\u0B5D\u0B5F-\u0B61\u0B71\u0B82-\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99-\u0B9A\u0B9C\u0B9E-\u0B9F\u0BA3-\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB5\u0BB7-\u0BB9\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCC\u0BD7\u0C01-\u0C03\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C33\u0C35-\u0C39\u0C3E-\u0C44\u0C46-\u0C48\u0C4A-\u0C4C\u0C55-\u0C56\u0C60-\u0C61\u0C82-\u0C83\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCC\u0CD5-\u0CD6\u0CDE\u0CE0-\u0CE1\u0D02-\u0D03\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D28\u0D2A-\u0D39\u0D3E-\u0D43\u0D46-\u0D48\u0D4A-\u0D4C\u0D57\u0D60-\u0D61\u0D82-\u0D83\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DF2-\u0DF3\u0F00\u0F40-\u0F47\u0F49-\u0F6A\u0F71-\u0F81\u0F88-\u0F8B\u0F90-\u0F97\u0F99-\u0FBC\u1000-\u1021\u1023-\u1027\u1029-\u102A\u102C-\u1032\u1036\u1038\u1050-\u1059\u10A0-\u10C5\u10D0-\u10F8\u1100-\u1159\u115F-\u11A2\u11A8-\u11F9\u1200-\u1206\u1208-\u1246\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1286\u1288\u128A-\u128D\u1290-\u12AE\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12CE\u12D0-\u12D6\u12D8-\u12EE\u12F0-\u130E\u1310\u1312-\u1315\u1318-\u131E\u1320-\u1346\u1348-\u135A\u13A0-\u13F4\u1401-\u166C\u166F-\u1676\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F0\u1700-\u170C\u170E-\u1713\u1720-\u1733\u1740-\u1753\u1760-\u176C\u176E-\u1770\u1772-\u1773\u1780-\u17B3\u17B6-\u17C8\u17D7\u17DC\u1820-\u1877\u1880-\u18A9\u1900-\u191C\u1920-\u192B\u1930-\u1938\u1950-\u196D\u1970-\u1974\u1D00-\u1D6B\u1E00-\u1E9B\u1EA0-\u1EF9\u1F00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2131\u2133-\u2139\u213D-\u213F\u2145-\u2149\u2160-\u2183\u3005\u3031-\u3035\u303B-\u303C\u3105-\u312C\u3131-\u318E\u31A0-\u31B7\uA000-\uA48C\uAC00-\uD7A3\uFA30-\uFA6A\uFB00-\uFB06\uFB13-\uFB17\uFB1D-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40-\uFB41\uFB43-\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFFA0-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]/g;
    sentence = sentence.replace(re, '');
  }
  return sentence.toLowerCase();
}

function getBestSentence(paragraph, cached) {
  var sentences = splitContentToSentences(paragraph);
  if (!sentences) return '';
  if (sentences.length < 2) return '';

  var _sentences$reduce = sentences.reduce(function (_ref, sentence) {
    var score = _ref.score,
        best = _ref.best;

    var s = cached[formatSentence(sentence)];
    return s > score ? { score: s, best: sentence } : { score: score, best: best };
  }, { score: 0, best: '' }),
      best = _sentences$reduce.best;

  return best;
}

function getSortedSentences(paragraph, cached, n) {
  var sentences = splitContentToSentences(paragraph);
  if (!sentences) return '';
  if (sentences.length < 2) return '';

  var scores = sentences.map(function (sentence, i) {
    var formatted = formatSentence(sentence);
    return {
      sentence: sentence,
      score: cached[formatted],
      order: i
    };
  }).filter(function (s) {
    return s;
  }).sort(function (_ref2) {
    var score = _ref2.score;
    return score;
  });

  return scores.slice(0, Math.max(0, Math.min(scores.length, n))).sort(function (_ref3) {
    var order = _ref3.order;
    return order;
  }).map(function (_ref4) {
    var sentence = _ref4.sentence;
    return sentence;
  });
}

function getSentencesRanks(content, cached, filter) {
  if (cached) return cached;
  var sentences = splitContentToSentences(content);
  if (filter) {
    sentences = sentences.filter(filter);
  }
  var n = sentences.length;
  var nRange = _lodash2.default.range(n);

  // Intersectional value of all other sentences
  var values = nRange.map(function (x) {
    return nRange.map(function (y) {
      return x === y ? 0 : sentencesIntersection(sentences[x], sentences[y]);
    });
  });

  // Sentences are scored by the sum of their intersectionality of other sentences
  return nRange.reduce(function (cached, i) {
    var score = nRange.reduce(function (score, j) {
      return score + values[i][j];
    }, 0);
    var sentence = formatSentence(sentences[i]);
    return Object.assign(cached, _defineProperty({}, sentence, score));
  }, {});
}
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImhlbHBlcnMvc3VtbWFyaXplci5qcyJdLCJuYW1lcyI6WyJzcGxpdENvbnRlbnRUb1BhcmFncmFwaHMiLCJmb3JtYXRTZW50ZW5jZSIsImdldEJlc3RTZW50ZW5jZSIsImdldFNvcnRlZFNlbnRlbmNlcyIsImdldFNlbnRlbmNlc1JhbmtzIiwic3BsaXRDb250ZW50VG9TZW50ZW5jZXMiLCJjb250ZW50IiwiaW5kZXhPZiIsIlRva2VuaXplciIsInNlbnRlbmNlcyIsIm5ld2xpbmVfYm91bmRhcmllcyIsInNwbGl0Iiwic2VudGVuY2VzSW50ZXJzZWN0aW9uIiwic2VudDEiLCJzZW50MiIsInMxIiwiczIiLCJsZW5ndGgiLCJpbnRlcnNlY3QiLCJzcGxpY2VIZXJlIiwic3BsaWNlIiwic2VudGVuY2UiLCJyZXBsYWNlIiwicmUiLCJ0b0xvd2VyQ2FzZSIsInBhcmFncmFwaCIsImNhY2hlZCIsInJlZHVjZSIsInNjb3JlIiwiYmVzdCIsInMiLCJuIiwic2NvcmVzIiwibWFwIiwiaSIsImZvcm1hdHRlZCIsIm9yZGVyIiwiZmlsdGVyIiwic29ydCIsInNsaWNlIiwiTWF0aCIsIm1heCIsIm1pbiIsIm5SYW5nZSIsIl8iLCJyYW5nZSIsInZhbHVlcyIsIngiLCJ5IiwiaiIsIk9iamVjdCIsImFzc2lnbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7UUFTZ0JBLHdCLEdBQUFBLHdCO1FBZUFDLGMsR0FBQUEsYztRQVVBQyxlLEdBQUFBLGU7UUFXQUMsa0IsR0FBQUEsa0I7UUF1QkFDLGlCLEdBQUFBLGlCOztBQXBFaEI7Ozs7QUFDQTs7OztBQUNBOzs7Ozs7QUFFQSxTQUFTQyx1QkFBVCxDQUFrQ0MsT0FBbEMsRUFBMkM7QUFDekMsTUFBSUEsUUFBUUMsT0FBUixDQUFnQixHQUFoQixNQUF5QixDQUFDLENBQTlCLEVBQWlDLE9BQU8sRUFBUDtBQUNqQyxTQUFPQyxjQUFVQyxTQUFWLENBQW9CSCxPQUFwQixFQUE2QixFQUFDSSxvQkFBb0IsSUFBckIsRUFBN0IsS0FBNEQsRUFBbkU7QUFDRDs7QUFFTSxTQUFTVix3QkFBVCxDQUFtQ00sT0FBbkMsRUFBNEM7QUFDakQsU0FBT0EsUUFBUUssS0FBUixDQUFjLE1BQWQsQ0FBUDtBQUNEOztBQUVELFNBQVNDLHFCQUFULENBQWdDQyxLQUFoQyxFQUF1Q0MsS0FBdkMsRUFBOEM7QUFDNUMsTUFBTUMsS0FBS0YsTUFBTUYsS0FBTixDQUFZLEdBQVosQ0FBWDtBQUNBLE1BQU1LLEtBQUtGLE1BQU1ILEtBQU4sQ0FBWSxHQUFaLENBQVg7O0FBRUEsTUFBS0ksR0FBR0UsTUFBSCxHQUFZRCxHQUFHQyxNQUFoQixLQUE0QixDQUFoQyxFQUFtQyxPQUFPLENBQVA7O0FBRW5DLE1BQU1DLFlBQVksa0NBQWNILEVBQWQsRUFBa0JDLEVBQWxCLENBQWxCO0FBQ0EsTUFBTUcsYUFBYyxDQUFDSixHQUFHRSxNQUFILEdBQVlELEdBQUdDLE1BQWhCLElBQTBCLENBQTlDO0FBQ0EsU0FBT0MsVUFBVUUsTUFBVixDQUFpQixDQUFqQixFQUFvQkQsVUFBcEIsRUFBZ0NGLE1BQXZDO0FBQ0Q7O0FBRU0sU0FBU2hCLGNBQVQsQ0FBeUJvQixRQUF6QixFQUFtQztBQUN4QyxNQUFJQSxZQUFZQSxTQUFTQyxPQUF6QixFQUFrQztBQUNoQztBQUNBO0FBQ0EsUUFBTUMsS0FBSyxvK0dBQVg7QUFDQUYsZUFBV0EsU0FBU0MsT0FBVCxDQUFpQkMsRUFBakIsRUFBcUIsRUFBckIsQ0FBWDtBQUNEO0FBQ0QsU0FBT0YsU0FBU0csV0FBVCxFQUFQO0FBQ0Q7O0FBRU0sU0FBU3RCLGVBQVQsQ0FBMEJ1QixTQUExQixFQUFxQ0MsTUFBckMsRUFBNkM7QUFDbEQsTUFBTWpCLFlBQVlKLHdCQUF3Qm9CLFNBQXhCLENBQWxCO0FBQ0EsTUFBSSxDQUFDaEIsU0FBTCxFQUFnQixPQUFPLEVBQVA7QUFDaEIsTUFBSUEsVUFBVVEsTUFBVixHQUFtQixDQUF2QixFQUEwQixPQUFPLEVBQVA7O0FBSHdCLDBCQUlqQ1IsVUFBVWtCLE1BQVYsQ0FBaUIsZ0JBQWtCTixRQUFsQixFQUErQjtBQUFBLFFBQTVCTyxLQUE0QixRQUE1QkEsS0FBNEI7QUFBQSxRQUFyQkMsSUFBcUIsUUFBckJBLElBQXFCOztBQUMvRCxRQUFNQyxJQUFJSixPQUFPekIsZUFBZW9CLFFBQWYsQ0FBUCxDQUFWO0FBQ0EsV0FBT1MsSUFBSUYsS0FBSixHQUFZLEVBQUVBLE9BQU9FLENBQVQsRUFBWUQsTUFBTVIsUUFBbEIsRUFBWixHQUEyQyxFQUFFTyxZQUFGLEVBQVNDLFVBQVQsRUFBbEQ7QUFDRCxHQUhnQixFQUdkLEVBQUVELE9BQU8sQ0FBVCxFQUFZQyxNQUFNLEVBQWxCLEVBSGMsQ0FKaUM7QUFBQSxNQUkxQ0EsSUFKMEMscUJBSTFDQSxJQUowQzs7QUFRbEQsU0FBT0EsSUFBUDtBQUNEOztBQUVNLFNBQVMxQixrQkFBVCxDQUE2QnNCLFNBQTdCLEVBQXdDQyxNQUF4QyxFQUFnREssQ0FBaEQsRUFBbUQ7QUFDeEQsTUFBTXRCLFlBQVlKLHdCQUF3Qm9CLFNBQXhCLENBQWxCO0FBQ0EsTUFBSSxDQUFDaEIsU0FBTCxFQUFnQixPQUFPLEVBQVA7QUFDaEIsTUFBSUEsVUFBVVEsTUFBVixHQUFtQixDQUF2QixFQUEwQixPQUFPLEVBQVA7O0FBRTFCLE1BQU1lLFNBQVN2QixVQUNad0IsR0FEWSxDQUNSLFVBQUNaLFFBQUQsRUFBV2EsQ0FBWCxFQUFpQjtBQUNwQixRQUFNQyxZQUFZbEMsZUFBZW9CLFFBQWYsQ0FBbEI7QUFDQSxXQUFPO0FBQ0xBLHdCQURLO0FBRUxPLGFBQU9GLE9BQU9TLFNBQVAsQ0FGRjtBQUdMQyxhQUFPRjtBQUhGLEtBQVA7QUFLRCxHQVJZLEVBU1pHLE1BVFksQ0FTTDtBQUFBLFdBQUtQLENBQUw7QUFBQSxHQVRLLEVBVVpRLElBVlksQ0FVUDtBQUFBLFFBQUdWLEtBQUgsU0FBR0EsS0FBSDtBQUFBLFdBQWVBLEtBQWY7QUFBQSxHQVZPLENBQWY7O0FBWUEsU0FBT0ksT0FDSk8sS0FESSxDQUNFLENBREYsRUFDS0MsS0FBS0MsR0FBTCxDQUFTLENBQVQsRUFBWUQsS0FBS0UsR0FBTCxDQUFTVixPQUFPZixNQUFoQixFQUF3QmMsQ0FBeEIsQ0FBWixDQURMLEVBRUpPLElBRkksQ0FFQztBQUFBLFFBQUdGLEtBQUgsU0FBR0EsS0FBSDtBQUFBLFdBQWVBLEtBQWY7QUFBQSxHQUZELEVBR0pILEdBSEksQ0FHQTtBQUFBLFFBQUdaLFFBQUgsU0FBR0EsUUFBSDtBQUFBLFdBQWtCQSxRQUFsQjtBQUFBLEdBSEEsQ0FBUDtBQUlEOztBQUVNLFNBQVNqQixpQkFBVCxDQUE0QkUsT0FBNUIsRUFBcUNvQixNQUFyQyxFQUE2Q1csTUFBN0MsRUFBcUQ7QUFDMUQsTUFBSVgsTUFBSixFQUFZLE9BQU9BLE1BQVA7QUFDWixNQUFJakIsWUFBWUosd0JBQXdCQyxPQUF4QixDQUFoQjtBQUNBLE1BQUkrQixNQUFKLEVBQVk7QUFDVjVCLGdCQUFZQSxVQUFVNEIsTUFBVixDQUFpQkEsTUFBakIsQ0FBWjtBQUNEO0FBQ0QsTUFBSU4sSUFBSXRCLFVBQVVRLE1BQWxCO0FBQ0EsTUFBSTBCLFNBQVNDLGlCQUFFQyxLQUFGLENBQVFkLENBQVIsQ0FBYjs7QUFFQTtBQUNBLE1BQU1lLFNBQVNILE9BQU9WLEdBQVAsQ0FBVztBQUFBLFdBQUtVLE9BQU9WLEdBQVAsQ0FBVztBQUFBLGFBQUtjLE1BQU1DLENBQU4sR0FBVSxDQUFWLEdBQWNwQyxzQkFBc0JILFVBQVVzQyxDQUFWLENBQXRCLEVBQW9DdEMsVUFBVXVDLENBQVYsQ0FBcEMsQ0FBbkI7QUFBQSxLQUFYLENBQUw7QUFBQSxHQUFYLENBQWY7O0FBRUE7QUFDQSxTQUFPTCxPQUFPaEIsTUFBUCxDQUFjLFVBQUNELE1BQUQsRUFBU1EsQ0FBVCxFQUFlO0FBQ2xDLFFBQU1OLFFBQVFlLE9BQU9oQixNQUFQLENBQWMsVUFBQ0MsS0FBRCxFQUFRcUIsQ0FBUjtBQUFBLGFBQWNyQixRQUFRa0IsT0FBT1osQ0FBUCxFQUFVZSxDQUFWLENBQXRCO0FBQUEsS0FBZCxFQUFrRCxDQUFsRCxDQUFkO0FBQ0EsUUFBTTVCLFdBQVdwQixlQUFlUSxVQUFVeUIsQ0FBVixDQUFmLENBQWpCO0FBQ0EsV0FBT2dCLE9BQU9DLE1BQVAsQ0FBY3pCLE1BQWQsc0JBQXlCTCxRQUF6QixFQUFvQ08sS0FBcEMsRUFBUDtBQUNELEdBSk0sRUFJSixFQUpJLENBQVA7QUFLRCIsImZpbGUiOiJoZWxwZXJzL3N1bW1hcml6ZXIuanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgVG9rZW5pemVyIGZyb20gJ3NiZCdcbmltcG9ydCBfIGZyb20gJ2xvZGFzaCdcbmltcG9ydCB7IGludGVyc2VjdFNhZmUgfSBmcm9tICcuL2ludGVyc2VjdFNhZmUnXG5cbmZ1bmN0aW9uIHNwbGl0Q29udGVudFRvU2VudGVuY2VzIChjb250ZW50KSB7XG4gIGlmIChjb250ZW50LmluZGV4T2YoJy4nKSA9PT0gLTEpIHJldHVybiBbXVxuICByZXR1cm4gVG9rZW5pemVyLnNlbnRlbmNlcyhjb250ZW50LCB7bmV3bGluZV9ib3VuZGFyaWVzOiB0cnVlfSkgfHwgW11cbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHNwbGl0Q29udGVudFRvUGFyYWdyYXBocyAoY29udGVudCkge1xuICByZXR1cm4gY29udGVudC5zcGxpdCgnXFxuXFxuJylcbn1cblxuZnVuY3Rpb24gc2VudGVuY2VzSW50ZXJzZWN0aW9uIChzZW50MSwgc2VudDIpIHtcbiAgY29uc3QgczEgPSBzZW50MS5zcGxpdCgnICcpXG4gIGNvbnN0IHMyID0gc2VudDIuc3BsaXQoJyAnKVxuXG4gIGlmICgoczEubGVuZ3RoICsgczIubGVuZ3RoKSA9PT0gMCkgcmV0dXJuIDBcblxuICBjb25zdCBpbnRlcnNlY3QgPSBpbnRlcnNlY3RTYWZlKHMxLCBzMilcbiAgY29uc3Qgc3BsaWNlSGVyZSA9ICgoczEubGVuZ3RoICsgczIubGVuZ3RoKSAvIDIpXG4gIHJldHVybiBpbnRlcnNlY3Quc3BsaWNlKDAsIHNwbGljZUhlcmUpLmxlbmd0aFxufVxuXG5leHBvcnQgZnVuY3Rpb24gZm9ybWF0U2VudGVuY2UgKHNlbnRlbmNlKSB7XG4gIGlmIChzZW50ZW5jZSAmJiBzZW50ZW5jZS5yZXBsYWNlKSB7XG4gICAgLy8gVG8gc3VwcG9ydCB1bmljb2RlIGNoYXJhY3RlcnMuXG4gICAgLy8gaHR0cDovL3d3dy51bmljb2RlLm9yZy9yZXBvcnRzL3RyMjkvV29yZEJyZWFrVGVzdC5odG1sXG4gICAgY29uc3QgcmUgPSAvW15BLVphLXpcXHUwMEFBXFx1MDBCNVxcdTAwQkFcXHUwMEMwLVxcdTAwRDZcXHUwMEQ4LVxcdTAwRjZcXHUwMEY4LVxcdTAyMzZcXHUwMjUwLVxcdTAyQzFcXHUwMkM2LVxcdTAyRDFcXHUwMkUwLVxcdTAyRTRcXHUwMkVFXFx1MDM0NVxcdTAzN0FcXHUwMzg2XFx1MDM4OC1cXHUwMzhBXFx1MDM4Q1xcdTAzOEUtXFx1MDNBMVxcdTAzQTMtXFx1MDNDRVxcdTAzRDAtXFx1MDNGNVxcdTAzRjctXFx1MDNGQlxcdTA0MDAtXFx1MDQ4MVxcdTA0OEEtXFx1MDRDRVxcdTA0RDAtXFx1MDRGNVxcdTA0RjgtXFx1MDRGOVxcdTA1MDAtXFx1MDUwRlxcdTA1MzEtXFx1MDU1NlxcdTA1NTlcXHUwNTYxLVxcdTA1ODdcXHUwNUIwLVxcdTA1QjlcXHUwNUJCLVxcdTA1QkRcXHUwNUJGXFx1MDVDMS1cXHUwNUMyXFx1MDVDNFxcdTA1RDAtXFx1MDVFQVxcdTA1RjAtXFx1MDVGM1xcdTA2MTAtXFx1MDYxNVxcdTA2MjEtXFx1MDYzQVxcdTA2NDAtXFx1MDY1N1xcdTA2NkUtXFx1MDZEM1xcdTA2RDUtXFx1MDZEQ1xcdTA2RTEtXFx1MDZFOFxcdTA2RUQtXFx1MDZFRlxcdTA2RkEtXFx1MDZGQ1xcdTA2RkZcXHUwNzEwLVxcdTA3M0ZcXHUwNzRELVxcdTA3NEZcXHUwNzgwLVxcdTA3QjFcXHUwOTAxLVxcdTA5MzlcXHUwOTNELVxcdTA5NENcXHUwOTUwXFx1MDk1OC1cXHUwOTYzXFx1MDk4MS1cXHUwOTgzXFx1MDk4NS1cXHUwOThDXFx1MDk4Ri1cXHUwOTkwXFx1MDk5My1cXHUwOUE4XFx1MDlBQS1cXHUwOUIwXFx1MDlCMlxcdTA5QjYtXFx1MDlCOVxcdTA5QkQtXFx1MDlDNFxcdTA5QzctXFx1MDlDOFxcdTA5Q0ItXFx1MDlDQ1xcdTA5RDdcXHUwOURDLVxcdTA5RERcXHUwOURGLVxcdTA5RTNcXHUwOUYwLVxcdTA5RjFcXHUwQTAxLVxcdTBBMDNcXHUwQTA1LVxcdTBBMEFcXHUwQTBGLVxcdTBBMTBcXHUwQTEzLVxcdTBBMjhcXHUwQTJBLVxcdTBBMzBcXHUwQTMyLVxcdTBBMzNcXHUwQTM1LVxcdTBBMzZcXHUwQTM4LVxcdTBBMzlcXHUwQTNFLVxcdTBBNDJcXHUwQTQ3LVxcdTBBNDhcXHUwQTRCLVxcdTBBNENcXHUwQTU5LVxcdTBBNUNcXHUwQTVFXFx1MEE3MC1cXHUwQTc0XFx1MEE4MS1cXHUwQTgzXFx1MEE4NS1cXHUwQThEXFx1MEE4Ri1cXHUwQTkxXFx1MEE5My1cXHUwQUE4XFx1MEFBQS1cXHUwQUIwXFx1MEFCMi1cXHUwQUIzXFx1MEFCNS1cXHUwQUI5XFx1MEFCRC1cXHUwQUM1XFx1MEFDNy1cXHUwQUM5XFx1MEFDQi1cXHUwQUNDXFx1MEFEMFxcdTBBRTAtXFx1MEFFM1xcdTBCMDEtXFx1MEIwM1xcdTBCMDUtXFx1MEIwQ1xcdTBCMEYtXFx1MEIxMFxcdTBCMTMtXFx1MEIyOFxcdTBCMkEtXFx1MEIzMFxcdTBCMzItXFx1MEIzM1xcdTBCMzUtXFx1MEIzOVxcdTBCM0QtXFx1MEI0M1xcdTBCNDctXFx1MEI0OFxcdTBCNEItXFx1MEI0Q1xcdTBCNTYtXFx1MEI1N1xcdTBCNUMtXFx1MEI1RFxcdTBCNUYtXFx1MEI2MVxcdTBCNzFcXHUwQjgyLVxcdTBCODNcXHUwQjg1LVxcdTBCOEFcXHUwQjhFLVxcdTBCOTBcXHUwQjkyLVxcdTBCOTVcXHUwQjk5LVxcdTBCOUFcXHUwQjlDXFx1MEI5RS1cXHUwQjlGXFx1MEJBMy1cXHUwQkE0XFx1MEJBOC1cXHUwQkFBXFx1MEJBRS1cXHUwQkI1XFx1MEJCNy1cXHUwQkI5XFx1MEJCRS1cXHUwQkMyXFx1MEJDNi1cXHUwQkM4XFx1MEJDQS1cXHUwQkNDXFx1MEJEN1xcdTBDMDEtXFx1MEMwM1xcdTBDMDUtXFx1MEMwQ1xcdTBDMEUtXFx1MEMxMFxcdTBDMTItXFx1MEMyOFxcdTBDMkEtXFx1MEMzM1xcdTBDMzUtXFx1MEMzOVxcdTBDM0UtXFx1MEM0NFxcdTBDNDYtXFx1MEM0OFxcdTBDNEEtXFx1MEM0Q1xcdTBDNTUtXFx1MEM1NlxcdTBDNjAtXFx1MEM2MVxcdTBDODItXFx1MEM4M1xcdTBDODUtXFx1MEM4Q1xcdTBDOEUtXFx1MEM5MFxcdTBDOTItXFx1MENBOFxcdTBDQUEtXFx1MENCM1xcdTBDQjUtXFx1MENCOVxcdTBDQkQtXFx1MENDNFxcdTBDQzYtXFx1MENDOFxcdTBDQ0EtXFx1MENDQ1xcdTBDRDUtXFx1MENENlxcdTBDREVcXHUwQ0UwLVxcdTBDRTFcXHUwRDAyLVxcdTBEMDNcXHUwRDA1LVxcdTBEMENcXHUwRDBFLVxcdTBEMTBcXHUwRDEyLVxcdTBEMjhcXHUwRDJBLVxcdTBEMzlcXHUwRDNFLVxcdTBENDNcXHUwRDQ2LVxcdTBENDhcXHUwRDRBLVxcdTBENENcXHUwRDU3XFx1MEQ2MC1cXHUwRDYxXFx1MEQ4Mi1cXHUwRDgzXFx1MEQ4NS1cXHUwRDk2XFx1MEQ5QS1cXHUwREIxXFx1MERCMy1cXHUwREJCXFx1MERCRFxcdTBEQzAtXFx1MERDNlxcdTBEQ0YtXFx1MERENFxcdTBERDZcXHUwREQ4LVxcdTBEREZcXHUwREYyLVxcdTBERjNcXHUwRjAwXFx1MEY0MC1cXHUwRjQ3XFx1MEY0OS1cXHUwRjZBXFx1MEY3MS1cXHUwRjgxXFx1MEY4OC1cXHUwRjhCXFx1MEY5MC1cXHUwRjk3XFx1MEY5OS1cXHUwRkJDXFx1MTAwMC1cXHUxMDIxXFx1MTAyMy1cXHUxMDI3XFx1MTAyOS1cXHUxMDJBXFx1MTAyQy1cXHUxMDMyXFx1MTAzNlxcdTEwMzhcXHUxMDUwLVxcdTEwNTlcXHUxMEEwLVxcdTEwQzVcXHUxMEQwLVxcdTEwRjhcXHUxMTAwLVxcdTExNTlcXHUxMTVGLVxcdTExQTJcXHUxMUE4LVxcdTExRjlcXHUxMjAwLVxcdTEyMDZcXHUxMjA4LVxcdTEyNDZcXHUxMjQ4XFx1MTI0QS1cXHUxMjREXFx1MTI1MC1cXHUxMjU2XFx1MTI1OFxcdTEyNUEtXFx1MTI1RFxcdTEyNjAtXFx1MTI4NlxcdTEyODhcXHUxMjhBLVxcdTEyOERcXHUxMjkwLVxcdTEyQUVcXHUxMkIwXFx1MTJCMi1cXHUxMkI1XFx1MTJCOC1cXHUxMkJFXFx1MTJDMFxcdTEyQzItXFx1MTJDNVxcdTEyQzgtXFx1MTJDRVxcdTEyRDAtXFx1MTJENlxcdTEyRDgtXFx1MTJFRVxcdTEyRjAtXFx1MTMwRVxcdTEzMTBcXHUxMzEyLVxcdTEzMTVcXHUxMzE4LVxcdTEzMUVcXHUxMzIwLVxcdTEzNDZcXHUxMzQ4LVxcdTEzNUFcXHUxM0EwLVxcdTEzRjRcXHUxNDAxLVxcdTE2NkNcXHUxNjZGLVxcdTE2NzZcXHUxNjgxLVxcdTE2OUFcXHUxNkEwLVxcdTE2RUFcXHUxNkVFLVxcdTE2RjBcXHUxNzAwLVxcdTE3MENcXHUxNzBFLVxcdTE3MTNcXHUxNzIwLVxcdTE3MzNcXHUxNzQwLVxcdTE3NTNcXHUxNzYwLVxcdTE3NkNcXHUxNzZFLVxcdTE3NzBcXHUxNzcyLVxcdTE3NzNcXHUxNzgwLVxcdTE3QjNcXHUxN0I2LVxcdTE3QzhcXHUxN0Q3XFx1MTdEQ1xcdTE4MjAtXFx1MTg3N1xcdTE4ODAtXFx1MThBOVxcdTE5MDAtXFx1MTkxQ1xcdTE5MjAtXFx1MTkyQlxcdTE5MzAtXFx1MTkzOFxcdTE5NTAtXFx1MTk2RFxcdTE5NzAtXFx1MTk3NFxcdTFEMDAtXFx1MUQ2QlxcdTFFMDAtXFx1MUU5QlxcdTFFQTAtXFx1MUVGOVxcdTFGMDAtXFx1MUYxNVxcdTFGMTgtXFx1MUYxRFxcdTFGMjAtXFx1MUY0NVxcdTFGNDgtXFx1MUY0RFxcdTFGNTAtXFx1MUY1N1xcdTFGNTlcXHUxRjVCXFx1MUY1RFxcdTFGNUYtXFx1MUY3RFxcdTFGODAtXFx1MUZCNFxcdTFGQjYtXFx1MUZCQ1xcdTFGQkVcXHUxRkMyLVxcdTFGQzRcXHUxRkM2LVxcdTFGQ0NcXHUxRkQwLVxcdTFGRDNcXHUxRkQ2LVxcdTFGREJcXHUxRkUwLVxcdTFGRUNcXHUxRkYyLVxcdTFGRjRcXHUxRkY2LVxcdTFGRkNcXHUyMDcxXFx1MjA3RlxcdTIxMDJcXHUyMTA3XFx1MjEwQS1cXHUyMTEzXFx1MjExNVxcdTIxMTktXFx1MjExRFxcdTIxMjRcXHUyMTI2XFx1MjEyOFxcdTIxMkEtXFx1MjEyRFxcdTIxMkYtXFx1MjEzMVxcdTIxMzMtXFx1MjEzOVxcdTIxM0QtXFx1MjEzRlxcdTIxNDUtXFx1MjE0OVxcdTIxNjAtXFx1MjE4M1xcdTMwMDVcXHUzMDMxLVxcdTMwMzVcXHUzMDNCLVxcdTMwM0NcXHUzMTA1LVxcdTMxMkNcXHUzMTMxLVxcdTMxOEVcXHUzMUEwLVxcdTMxQjdcXHVBMDAwLVxcdUE0OENcXHVBQzAwLVxcdUQ3QTNcXHVGQTMwLVxcdUZBNkFcXHVGQjAwLVxcdUZCMDZcXHVGQjEzLVxcdUZCMTdcXHVGQjFELVxcdUZCMjhcXHVGQjJBLVxcdUZCMzZcXHVGQjM4LVxcdUZCM0NcXHVGQjNFXFx1RkI0MC1cXHVGQjQxXFx1RkI0My1cXHVGQjQ0XFx1RkI0Ni1cXHVGQkIxXFx1RkJEMy1cXHVGRDNEXFx1RkQ1MC1cXHVGRDhGXFx1RkQ5Mi1cXHVGREM3XFx1RkRGMC1cXHVGREZCXFx1RkU3MC1cXHVGRTc0XFx1RkU3Ni1cXHVGRUZDXFx1RkYyMS1cXHVGRjNBXFx1RkY0MS1cXHVGRjVBXFx1RkZBMC1cXHVGRkJFXFx1RkZDMi1cXHVGRkM3XFx1RkZDQS1cXHVGRkNGXFx1RkZEMi1cXHVGRkQ3XFx1RkZEQS1cXHVGRkRDXS9nXG4gICAgc2VudGVuY2UgPSBzZW50ZW5jZS5yZXBsYWNlKHJlLCAnJylcbiAgfVxuICByZXR1cm4gc2VudGVuY2UudG9Mb3dlckNhc2UoKVxufVxuXG5leHBvcnQgZnVuY3Rpb24gZ2V0QmVzdFNlbnRlbmNlIChwYXJhZ3JhcGgsIGNhY2hlZCkge1xuICBjb25zdCBzZW50ZW5jZXMgPSBzcGxpdENvbnRlbnRUb1NlbnRlbmNlcyhwYXJhZ3JhcGgpXG4gIGlmICghc2VudGVuY2VzKSByZXR1cm4gJydcbiAgaWYgKHNlbnRlbmNlcy5sZW5ndGggPCAyKSByZXR1cm4gJydcbiAgY29uc3QgeyBiZXN0IH0gPSBzZW50ZW5jZXMucmVkdWNlKCh7IHNjb3JlLCBiZXN0IH0sIHNlbnRlbmNlKSA9PiB7XG4gICAgY29uc3QgcyA9IGNhY2hlZFtmb3JtYXRTZW50ZW5jZShzZW50ZW5jZSldXG4gICAgcmV0dXJuIHMgPiBzY29yZSA/IHsgc2NvcmU6IHMsIGJlc3Q6IHNlbnRlbmNlIH0gOiB7IHNjb3JlLCBiZXN0IH1cbiAgfSwgeyBzY29yZTogMCwgYmVzdDogJycgfSlcbiAgcmV0dXJuIGJlc3Rcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGdldFNvcnRlZFNlbnRlbmNlcyAocGFyYWdyYXBoLCBjYWNoZWQsIG4pIHtcbiAgY29uc3Qgc2VudGVuY2VzID0gc3BsaXRDb250ZW50VG9TZW50ZW5jZXMocGFyYWdyYXBoKVxuICBpZiAoIXNlbnRlbmNlcykgcmV0dXJuICcnXG4gIGlmIChzZW50ZW5jZXMubGVuZ3RoIDwgMikgcmV0dXJuICcnXG5cbiAgY29uc3Qgc2NvcmVzID0gc2VudGVuY2VzXG4gICAgLm1hcCgoc2VudGVuY2UsIGkpID0+IHtcbiAgICAgIGNvbnN0IGZvcm1hdHRlZCA9IGZvcm1hdFNlbnRlbmNlKHNlbnRlbmNlKVxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc2VudGVuY2UsXG4gICAgICAgIHNjb3JlOiBjYWNoZWRbZm9ybWF0dGVkXSxcbiAgICAgICAgb3JkZXI6IGlcbiAgICAgIH1cbiAgICB9KVxuICAgIC5maWx0ZXIocyA9PiBzKVxuICAgIC5zb3J0KCh7IHNjb3JlIH0pID0+IHNjb3JlKVxuXG4gIHJldHVybiBzY29yZXNcbiAgICAuc2xpY2UoMCwgTWF0aC5tYXgoMCwgTWF0aC5taW4oc2NvcmVzLmxlbmd0aCwgbikpKVxuICAgIC5zb3J0KCh7IG9yZGVyIH0pID0+IG9yZGVyKVxuICAgIC5tYXAoKHsgc2VudGVuY2UgfSkgPT4gc2VudGVuY2UpXG59XG5cbmV4cG9ydCBmdW5jdGlvbiBnZXRTZW50ZW5jZXNSYW5rcyAoY29udGVudCwgY2FjaGVkLCBmaWx0ZXIpIHtcbiAgaWYgKGNhY2hlZCkgcmV0dXJuIGNhY2hlZFxuICBsZXQgc2VudGVuY2VzID0gc3BsaXRDb250ZW50VG9TZW50ZW5jZXMoY29udGVudClcbiAgaWYgKGZpbHRlcikge1xuICAgIHNlbnRlbmNlcyA9IHNlbnRlbmNlcy5maWx0ZXIoZmlsdGVyKTtcbiAgfVxuICBsZXQgbiA9IHNlbnRlbmNlcy5sZW5ndGhcbiAgbGV0IG5SYW5nZSA9IF8ucmFuZ2UobilcblxuICAvLyBJbnRlcnNlY3Rpb25hbCB2YWx1ZSBvZiBhbGwgb3RoZXIgc2VudGVuY2VzXG4gIGNvbnN0IHZhbHVlcyA9IG5SYW5nZS5tYXAoeCA9PiBuUmFuZ2UubWFwKHkgPT4geCA9PT0geSA/IDAgOiBzZW50ZW5jZXNJbnRlcnNlY3Rpb24oc2VudGVuY2VzW3hdLCBzZW50ZW5jZXNbeV0pKSlcblxuICAvLyBTZW50ZW5jZXMgYXJlIHNjb3JlZCBieSB0aGUgc3VtIG9mIHRoZWlyIGludGVyc2VjdGlvbmFsaXR5IG9mIG90aGVyIHNlbnRlbmNlc1xuICByZXR1cm4gblJhbmdlLnJlZHVjZSgoY2FjaGVkLCBpKSA9PiB7XG4gICAgY29uc3Qgc2NvcmUgPSBuUmFuZ2UucmVkdWNlKChzY29yZSwgaikgPT4gc2NvcmUgKyB2YWx1ZXNbaV1bal0sIDApXG4gICAgY29uc3Qgc2VudGVuY2UgPSBmb3JtYXRTZW50ZW5jZShzZW50ZW5jZXNbaV0pXG4gICAgcmV0dXJuIE9iamVjdC5hc3NpZ24oY2FjaGVkLCB7IFtzZW50ZW5jZV06IHNjb3JlIH0pXG4gIH0sIHt9KVxufVxuIl19
